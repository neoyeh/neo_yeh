"use strict";!function(n){n.jSlots=function(i,o){var t=this;t.$el=n(i),t.el=i,t.$el.data("jSlots",t),t.init=function(){t.options=n.extend({},n.jSlots.defaultOptions,o),t.setup(),t.bindEvents()},n.jSlots.defaultOptions={number:3,winnerNumber:1,spinner:"",spinEvent:"click",onStart:n.noop,onEnd:n.noop,onWin:n.noop,easing:"swing",time:7e3,loops:6,delay:0},t.randomRange=function(n,i){return Math.floor(Math.random()*(1+i-n))+n},t.isSpinning=!1,t.spinSpeed=0,t.winCount=0,t.doneCount=0,t.$liHeight=0,t.$liWidth=0,t.winners=[],t.allSlots=[],t.setup=function(){var n=t.$el,i=n.find("li").first();t.$liHeight=i.outerHeight(),t.$liWidth=i.outerWidth(),t.liCount=t.$el.children().length,t.listHeight=t.$liHeight*t.liCount,t.increment=t.options.time/t.options.loops/t.options.loops,n.css("position","relative"),i.clone().appendTo(n),t.$wrapper=n.wrap('<div class="jSlots-wrapper"></div>').parent(),t.$el.remove();for(var o=t.options.number-1;o>=0;o--)t.allSlots.push(new t.Slot)},t.bindEvents=function(){n(t.options.spinner).bind(t.options.spinEvent,function(n){t.isSpinning||setTimeout(function(){t.playSlots()},t.options.delay)})},t.Slot=function(){this.spinSpeed=0,this.el=t.$el.clone().appendTo(t.$wrapper)[0],this.$el=n(this.el),this.loopCount=0,this.number=0},t.Slot.prototype={spinEm:function(){var n=this;n.$el.css("top",-t.listHeight).animate({top:"0px"},n.spinSpeed,"linear",function(){n.lowerSpeed()})},lowerSpeed:function(){this.spinSpeed+=t.increment,this.loopCount++,this.loopCount<t.options.loops?this.spinEm():this.finish()},finish:function(){var n=this,i=o.winnerNumber,e=-(t.$liHeight*i-t.$liHeight),s=.5*this.spinSpeed*t.liCount/i;n.$el.css("top",-t.listHeight).animate({top:e},s,t.options.easing,function(){t.checkWinner(i,n)})}},t.checkWinner=function(i,o){if(t.doneCount++,o.number=i,(n.isArray(t.options.winnerNumber)&&t.options.winnerNumber.indexOf(i)>-1||i===t.options.winnerNumber)&&(t.winCount++,t.winners.push(o.$el)),t.doneCount===t.options.number){var e=[];n.each(t.allSlots,function(n,i){e[n]=i.number}),n.isFunction(t.options.onEnd)&&t.options.onEnd(e),t.winCount&&n.isFunction(t.options.onWin)&&t.options.onWin(t.winCount,t.winners,e),t.isSpinning=!1}},t.playSlots=function(){t.isSpinning=!0,t.winCount=0,t.doneCount=0,t.winners=[],n.isFunction(t.options.onStart)&&t.options.onStart(),n.each(t.allSlots,function(n,i){this.spinSpeed=0,this.loopCount=0,this.spinEm()})},t.onWin=function(){n.isFunction(t.options.onWin)&&t.options.onWin()},t.init()},n.fn.jSlots=function(i){if(this.length)return this.each(function(){new n.jSlots(this,i)})}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNsb3RtYWNoaW5lLW1pbi5qcyJdLCJuYW1lcyI6WyIkIiwialNsb3RzIiwiZWwiLCJvcHRpb25zIiwiYmFzZSIsInRoaXMiLCJkYXRhIiwiYmluZEV2ZW50cyIsImV4dGVuZCIsImRlZmF1bHRPcHRpb25zIiwic2V0dXAiLCJvblN0YXJ0Iiwid2lubmVyTnVtYmVyIiwic3Bpbm5lciIsInNwaW5FdmVudCIsIm5vb3AiLCJvbkVuZCIsIm9uV2luIiwiZWFzaW5nIiwidGltZSIsImxvb3BzIiwiZGVsYXkiLCJyYW5kb21SYW5nZSIsImxvdyIsImhpZ2giLCJmbG9vciIsIk1hdGgiLCJyYW5kb20iLCJzcGluU3BlZWQiLCJ3aW5Db3VudCIsImRvbmVDb3VudCIsIiRsaUhlaWdodCIsIndpbm5lcnMiLCJhbGxTbG90cyIsImxpQ291bnQiLCJjbG9uZSIsIiRsaXN0IiwiYXBwZW5kVG8iLCIkd3JhcHBlciIsIndyYXAiLCJmaXJzdCIsIiRlbCIsInJlbW92ZSIsIiRsaSIsIm91dGVySGVpZ2h0IiwiJGxpV2lkdGgiLCJvdXRlcldpZHRoIiwiU2xvdCIsImxlbmd0aCIsImxpc3RIZWlnaHQiLCJzZXRUaW1lb3V0IiwicGFyZW50IiwiaSIsIm51bWJlciIsInB1c2giLCJiaW5kIiwiZXZlbnQiLCJwcm90b3R5cGUiLCJpc1NwaW5uaW5nIiwicGxheVNsb3RzIiwibG9vcENvdW50Iiwic3BpbkVtIiwiZmluYWxQb3MiLCJ0aGF0IiwiYW5pbWF0ZSIsImNoZWNrV2lubmVyIiwiZW5kTnVtIiwiaW5jcmVtZW50IiwiZmluaXNoIiwiaXNGdW5jdGlvbiIsImZpbmFsTnVtYmVycyIsImZpbmFsU3BlZWQiLCJjc3MiLCJ0b3AiLCJzbG90IiwiaXNBcnJheSIsImluZGV4T2YiLCJlYWNoIiwiaW5kZXgiLCJ2YWwiLCJpbml0IiwiZm4iLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJjQU9BLFNBQUFBLEdBSU1DLEVBQUFBLE9BQVMsU0FBU0MsRUFBSUMsR0FJaEIsR0FBSkMsR0FB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RSxXQUFXakUsRUFBS0QsUUFBUWMsUUFDM0JiLEVBQUtELFFBQVFjLFNBTXJCYixFQUFLNEUsUUFRVGhGLEVBQUVpRixHQUFHaEYsT0FBUyxTQUFTRSxHQUNuQixHQUFJRSxLQUFLMkMsT0FDTCxNQUFPM0MsTUFBS3dFLEtBQUssV0FDWixHQUFJN0UsR0FBRUMsT0FBT0ksS0FBTUYsT0FLakMrRSIsImZpbGUiOiJzbG90bWFjaGluZS1taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogalF1ZXJ5IGpTbG90cyBQbHVnaW5cbiAqIGh0dHA6Ly9tYXR0aGV3bGVpbi5jb20vanNsb3QvXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTEgTWF0dGhldyBMZWluXG4gKiBWZXJzaW9uOiAxLjAuMiAoNy8yNi8yMDEyKVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXNcbiAqIFJlcXVpcmVzOiBqUXVlcnkgdjEuNC4xIG9yIGxhdGVyXG4gKi9cblxuKGZ1bmN0aW9uKCQpe1xuXG4gICAgJC5qU2xvdHMgPSBmdW5jdGlvbihlbCwgb3B0aW9ucyl7XG5cbiAgICAgICAgdmFyIGJhc2UgPSB0aGlzO1xuXG4gICAgICAgIGJhc2UuJGVsID0gJChlbCk7XG4gICAgICAgIGJhc2UuZWwgPSBlbDtcblxuICAgICAgICBiYXNlLiRlbC5kYXRhKFwialNsb3RzXCIsIGJhc2UpO1xuXG4gICAgICAgIGJhc2UuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBiYXNlLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwkLmpTbG90cy5kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIGJhc2Uuc2V0dXAoKTtcbiAgICAgICAgICAgIGJhc2UuYmluZEV2ZW50cygpO1xuXG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cbiAgICAgICAgLy8gREVGQVVMVCBPUFRJT05TXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG4gICAgICAgICQualNsb3RzLmRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICAgICAgbnVtYmVyIDogMywgICAgICAgICAgLy8gTnVtYmVyOiBudW1iZXIgb2Ygc2xvdHNcbiAgICAgICAgICAgIHdpbm5lck51bWJlciA6IDEsICAgIC8vIE51bWJlciBvciBBcnJheTogbGlzdCBpdGVtIG51bWJlcihzKSB1cG9uIHdoaWNoIHRvIHRyaWdnZXIgYSB3aW4sIDEtYmFzZWQgaW5kZXgsIE5PVCBaRVJPLUJBU0VEXG4gICAgICAgICAgICBzcGlubmVyIDogJycsICAgICAgICAvLyBDU1MgU2VsZWN0b3I6IGVsZW1lbnQgdG8gYmluZCB0aGUgc3RhcnQgZXZlbnQgdG9cbiAgICAgICAgICAgIHNwaW5FdmVudCA6ICdjbGljaycsIC8vIFN0cmluZzogZXZlbnQgdG8gc3RhcnQgc2xvdHMgb24gdGhpcyBldmVudFxuICAgICAgICAgICAgb25TdGFydCA6ICQubm9vcCwgICAgLy8gRnVuY3Rpb246IHJ1bnMgb24gc3BpbiBzdGFydCxcbiAgICAgICAgICAgIG9uRW5kIDogJC5ub29wLCAgICAgIC8vIEZ1bmN0aW9uOiBydW4gb24gc3BpbiBlbmQuIEl0IGlzIHBhc3NlZCAoZmluYWxOdW1iZXJzOkFycmF5KS4gZmluYWxOdW1iZXJzIGdpdmVzIHRoZSBpbmRleCBvZiB0aGUgbGkgZWFjaCBzbG90IHN0b3BwZWQgb24gaW4gb3JkZXIuXG4gICAgICAgICAgICBvbldpbiA6ICQubm9vcCwgICAgICAvLyBGdW5jdGlvbjogcnVuIG9uIHdpbm5pbmcgbnVtYmVyLiBJdCBpcyBwYXNzZWQgKHdpbkNvdW50Ok51bWJlciwgd2lubmVyczpBcnJheSlcbiAgICAgICAgICAgIGVhc2luZyA6ICdzd2luZycsICAgIC8vIFN0cmluZzogZWFzaW5nIHR5cGUgZm9yIGZpbmFsIHNwaW5cbiAgICAgICAgICAgIHRpbWUgOiA3MDAwLCAgICAgICAgIC8vIE51bWJlcjogdG90YWwgdGltZSBvZiBzcGluIGFuaW1hdGlvblxuICAgICAgICAgICAgbG9vcHMgOiA2ICwgICAgICAgICAgIC8vIE51bWJlcjogdGltZXMgaXQgd2lsbCBzcGluIGR1cmluZyB0aGUgYW5pbWF0aW9uXG4gICAgICAgICAgICBkZWxheTogMCxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cbiAgICAgICAgLy8gSEVMUEVSU1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuICAgICAgICBiYXNlLnJhbmRvbVJhbmdlID0gZnVuY3Rpb24obG93LCBoaWdoKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICgxICsgaGlnaCAtIGxvdykgKSArIGxvdztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cbiAgICAgICAgLy8gVkFSU1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuICAgICAgICBiYXNlLmlzU3Bpbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgYmFzZS5zcGluU3BlZWQgPSAwO1xuICAgICAgICBiYXNlLndpbkNvdW50ID0gMDtcbiAgICAgICAgYmFzZS5kb25lQ291bnQgPSAwO1xuXG4gICAgICAgIGJhc2UuJGxpSGVpZ2h0ID0gMDtcbiAgICAgICAgYmFzZS4kbGlXaWR0aCA9IDA7XG5cbiAgICAgICAgYmFzZS53aW5uZXJzID0gW107XG4gICAgICAgIGJhc2UuYWxsU2xvdHMgPSBbXTtcblxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cbiAgICAgICAgLy8gRlVOQ1RJT05TXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG5cbiAgICAgICAgYmFzZS5zZXR1cCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBzZXQgc2l6ZXNcblxuICAgICAgICAgICAgdmFyICRsaXN0ID0gYmFzZS4kZWw7XG4gICAgICAgICAgICB2YXIgJGxpID0gJGxpc3QuZmluZCgnbGknKS5maXJzdCgpO1xuXG4gICAgICAgICAgICBiYXNlLiRsaUhlaWdodCA9ICRsaS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgYmFzZS4kbGlXaWR0aCA9ICRsaS5vdXRlcldpZHRoKCk7XG5cbiAgICAgICAgICAgIGJhc2UubGlDb3VudCA9IGJhc2UuJGVsLmNoaWxkcmVuKCkubGVuZ3RoO1xuXG4gICAgICAgICAgICBiYXNlLmxpc3RIZWlnaHQgPSBiYXNlLiRsaUhlaWdodCAqIGJhc2UubGlDb3VudDtcblxuICAgICAgICAgICAgYmFzZS5pbmNyZW1lbnQgPSAoYmFzZS5vcHRpb25zLnRpbWUgLyBiYXNlLm9wdGlvbnMubG9vcHMpIC8gYmFzZS5vcHRpb25zLmxvb3BzO1xuICAgICAgICAgICAgJGxpc3QuY3NzKCdwb3NpdGlvbicsICdyZWxhdGl2ZScpO1xuXG4gICAgICAgICAgICAkbGkuY2xvbmUoKS5hcHBlbmRUbygkbGlzdCk7XG5cbiAgICAgICAgICAgIGJhc2UuJHdyYXBwZXIgPSAkbGlzdC53cmFwKCc8ZGl2IGNsYXNzPVwialNsb3RzLXdyYXBwZXJcIj48L2Rpdj4nKS5wYXJlbnQoKTtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIG9yaWdpbmFsLCBzbyBpdCBjYW4gYmUgcmVjcmVhdGVkIGFzIGEgU2xvdFxuICAgICAgICAgICAgYmFzZS4kZWwucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIGNsb25lIGxpc3RzXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gYmFzZS5vcHRpb25zLm51bWJlciAtIDE7IGkgPj0gMDsgaS0tKXtcbiAgICAgICAgICAgICAgICBiYXNlLmFsbFNsb3RzLnB1c2goIG5ldyBiYXNlLlNsb3QoKSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgYmFzZS5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKGJhc2Uub3B0aW9ucy5zcGlubmVyKS5iaW5kKGJhc2Uub3B0aW9ucy5zcGluRXZlbnQsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFiYXNlLmlzU3Bpbm5pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZS5wbGF5U2xvdHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxiYXNlLm9wdGlvbnMuZGVsYXkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU2xvdCBjb250c3RydWN0b3JcbiAgICAgICAgYmFzZS5TbG90ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3BpblNwZWVkID0gMDtcbiAgICAgICAgICAgIHRoaXMuZWwgPSBiYXNlLiRlbC5jbG9uZSgpLmFwcGVuZFRvKGJhc2UuJHdyYXBwZXIpWzBdO1xuICAgICAgICAgICAgdGhpcy4kZWwgPSAkKHRoaXMuZWwpO1xuICAgICAgICAgICAgdGhpcy5sb29wQ291bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5udW1iZXIgPSAwO1xuXG4gICAgICAgIH07XG5cblxuICAgICAgICBiYXNlLlNsb3QucHJvdG90eXBlID0ge1xuXG4gICAgICAgICAgICAvLyBkbyBvbmUgcm90YXRpb25cbiAgICAgICAgICAgIHNwaW5FbSA6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgdGhhdC4kZWxcbiAgICAgICAgICAgICAgICAgICAgLmNzcyggJ3RvcCcsIC1iYXNlLmxpc3RIZWlnaHQgKVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSggeyAndG9wJyA6ICcwcHgnIH0sIHRoYXQuc3BpblNwZWVkLCAnbGluZWFyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lmxvd2VyU3BlZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGxvd2VyU3BlZWQgOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuc3BpblNwZWVkICs9IGJhc2UuaW5jcmVtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMubG9vcENvdW50Kys7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMubG9vcENvdW50IDwgYmFzZS5vcHRpb25zLmxvb3BzICkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BpbkVtKCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoKCk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBmaW5hbCByb3RhdGlvblxuICAgICAgICAgICAgZmluaXNoIDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgLy8gdmFyIGVuZE51bSA9IGJhc2UucmFuZG9tUmFuZ2UoIDEsIGJhc2UubGlDb3VudCApO1xuICAgICAgICAgICAgICAgIHZhciBlbmROdW0gPSBvcHRpb25zLndpbm5lck51bWJlclxuICAgICAgICAgICAgICAgIHZhciBmaW5hbFBvcyA9IC0gKCAoYmFzZS4kbGlIZWlnaHQgKiBlbmROdW0pIC0gYmFzZS4kbGlIZWlnaHQgKTtcbiAgICAgICAgICAgICAgICB2YXIgZmluYWxTcGVlZCA9ICggKHRoaXMuc3BpblNwZWVkICogMC41KSAqIChiYXNlLmxpQ291bnQpICkgLyBlbmROdW07XG5cbiAgICAgICAgICAgICAgICB0aGF0LiRlbFxuICAgICAgICAgICAgICAgICAgICAuY3NzKCAndG9wJywgLWJhc2UubGlzdEhlaWdodCApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKCB7J3RvcCc6IGZpbmFsUG9zfSwgZmluYWxTcGVlZCwgYmFzZS5vcHRpb25zLmVhc2luZywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlLmNoZWNrV2lubmVyKGVuZE51bSwgdGhhdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBiYXNlLmNoZWNrV2lubmVyID0gZnVuY3Rpb24oZW5kTnVtLCBzbG90KSB7XG4gICAgICAgICAgICBiYXNlLmRvbmVDb3VudCsrO1xuICAgICAgICAgICAgLy8gc2V0IHRoZSBzbG90IG51bWJlciB0byB3aGF0ZXZlciBpdCBlbmRlZCBvblxuICAgICAgICAgICAgc2xvdC5udW1iZXIgPSBlbmROdW07XG5cbiAgICAgICAgICAgIC8vIGlmIGl0cyBpbiB0aGUgd2lubmVycyBhcnJheVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICggJC5pc0FycmF5KCBiYXNlLm9wdGlvbnMud2lubmVyTnVtYmVyICkgJiYgYmFzZS5vcHRpb25zLndpbm5lck51bWJlci5pbmRleE9mKGVuZE51bSkgPiAtMSApIHx8XG4gICAgICAgICAgICAgICAgZW5kTnVtID09PSBiYXNlLm9wdGlvbnMud2lubmVyTnVtYmVyXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBpdHMgYSB3aW5uZXIhXG4gICAgICAgICAgICAgICAgYmFzZS53aW5Db3VudCsrO1xuICAgICAgICAgICAgICAgIGJhc2Uud2lubmVycy5wdXNoKHNsb3QuJGVsKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYmFzZS5kb25lQ291bnQgPT09IGJhc2Uub3B0aW9ucy5udW1iZXIpIHtcblxuICAgICAgICAgICAgICAgIHZhciBmaW5hbE51bWJlcnMgPSBbXTtcblxuICAgICAgICAgICAgICAgICQuZWFjaChiYXNlLmFsbFNsb3RzLCBmdW5jdGlvbihpbmRleCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmFsTnVtYmVyc1tpbmRleF0gPSB2YWwubnVtYmVyO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGJhc2Uub3B0aW9ucy5vbkVuZCApICkge1xuICAgICAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMub25FbmQoZmluYWxOdW1iZXJzKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIGJhc2Uud2luQ291bnQgJiYgJC5pc0Z1bmN0aW9uKGJhc2Uub3B0aW9ucy5vbldpbikgKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5vbldpbihiYXNlLndpbkNvdW50LCBiYXNlLndpbm5lcnMsIGZpbmFsTnVtYmVycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJhc2UuaXNTcGlubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG5cbiAgICAgICAgYmFzZS5wbGF5U2xvdHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgYmFzZS5pc1NwaW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGJhc2Uud2luQ291bnQgPSAwO1xuICAgICAgICAgICAgYmFzZS5kb25lQ291bnQgPSAwO1xuICAgICAgICAgICAgYmFzZS53aW5uZXJzID0gW107XG5cbiAgICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKGJhc2Uub3B0aW9ucy5vblN0YXJ0KSApIHtcbiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMub25TdGFydCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmVhY2goYmFzZS5hbGxTbG90cywgZnVuY3Rpb24oaW5kZXgsIHZhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BpblNwZWVkID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmxvb3BDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGluRW0oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cblxuICAgICAgICBiYXNlLm9uV2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoICQuaXNGdW5jdGlvbihiYXNlLm9wdGlvbnMub25XaW4pICkge1xuICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5vbldpbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG5cbiAgICAgICAgLy8gUnVuIGluaXRpYWxpemVyXG4gICAgICAgIGJhc2UuaW5pdCgpO1xuICAgIH07XG5cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuICAgIC8vIEpRVUVSWSBGTlxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG4gICAgJC5mbi5qU2xvdHMgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgKG5ldyAkLmpTbG90cyh0aGlzLCBvcHRpb25zKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbn0pKGpRdWVyeSk7Il19
